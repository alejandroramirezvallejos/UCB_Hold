<div class="prestamos-container">
  <div class="header-section">
    <h1 class="title">Pr√©stamos Activos</h1>
    <p class="subtitle">Equipos actualmente Activos</p>
  </div>

  <div class="prestamos-list">
    @for (item of (datos | keyvalue) ; track item.key) {
      <div class="prestamo-item" >        <!-- Header del pr√©stamo -->
        <div class="item-header">
          <div class="usuario-info">
            <h3 class="usuario-nombre">üíª {{ item.value.datosgrupo.NombreGrupoEquipo }}</h3>
            <span class="cantidad-equipos">{{ item.value.equipos ? item.value.equipos.length : 0 }} equipos</span>
            <span class="usuario-carnet">{{ item.value.datosgrupo.NombreUsuario }} {{ item.value.datosgrupo.ApellidoPaternoUsuario }} - {{ item.value.datosgrupo.CarnetUsuario }}</span>
          </div>
          <div class="equipo-info">
            <span class="codigo-imt">Numero de prestamo :  {{ item.key }}</span>
           <span class="codigo-imt">Codigos IMTs : üìã {{ item.value.datosgrupo.CodigoImt || 'N/A' }}</span>
          </div>
        </div>

        <!-- Informaci√≥n de fechas -->
        <div class="fechas-info">
          <div class="fecha-item">
            <span class="fecha-label">üìÖ Solicitud:</span>
            <span class="fecha-valor">{{ item.value.datosgrupo.FechaSolicitud ? (item.value.datosgrupo.FechaSolicitud | date:'dd/MM/yyyy':'America/La_Paz') : 'N/A' }}</span>
          </div>

          <div class="fecha-item">
            <span class="fecha-label">üì¶ Fecha de Recogida:</span>
            <span class="fecha-valor">{{ item.value.datosgrupo.FechaPrestamoEsperada ? (item.value.datosgrupo.FechaPrestamoEsperada |  date:'dd/MM/yyyy':'America/La_Paz') : item.value.datosgrupo.FechaPrestamoEsperada }}</span>
          </div>

          <div class="fecha-item">
            <span class="fecha-label">‚è∞ Devoluci√≥n Esperada:</span>
            <span class="fecha-valor">{{ item.value.datosgrupo.FechaDevolucionEsperada ? (item.value.datosgrupo.FechaDevolucionEsperada | date:'dd/MM/yyyy') : 'N/A' }}</span>
          </div>
        </div>

        <div class="botones">
          <div class="botones-izquierda">
            <button class="finalizado" (click)="$event.stopPropagation(); avisoDevolver(item.value.datosgrupo)"> DEVUELTO</button>
          </div>
            <button class="ver-detalles" (click)="AbrirVista(item.value.equipos)"> VER DETALLES</button>
        </div>


      </div>
    }

    @if (datos.size === 0) {
      <div class="empty-state">
        <div class="empty-icon">üì•</div>
        <h3>No hay pr√©stamos activos</h3>
        <p>Actualmente no tienes equipos en pr√©stamo</p>
      </div>
    }
  </div>
</div>

@if(aviso()) {
  <app-aviso 
    [mensaje]="'Al apretar aceptar usted afirma que el equipo ha sido devuelto y se cerrar√° el pr√©stamo.'"
    [cerrar]="aviso"
    (aceptar)="finalizado()">
  </app-aviso>
}

@if(abrirVistaPrestamos){
  <app-vista-prestamos [prestamos]="prestamosVista" (cerrar)="cerrarVista()"></app-vista-prestamos>
}

@if(exito()){
  <app-aviso-exito
  [mensaje]="mensajeexito"
  [exito]="exito"
  ></app-aviso-exito>
}