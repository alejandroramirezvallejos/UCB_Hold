<div class="prestamos-container">
  <div class="header-section">
    <h1 class="title">Pr√©stamos Aprobados</h1>
    <p class="subtitle">Equipos actualmente Aprobados</p>
  </div>

  <div class="prestamos-list">
    @for (item of (datos | keyvalue) ; track item.key) {
      <div class="prestamo-item" (click)="AbrirVista(item.value.equipos)">        <!-- Header del pr√©stamo -->
        <div class="item-header">
          <div class="usuario-info">
            <h3 class="usuario-nombre">üíª {{ item.value.datosgrupo.NombreGrupoEquipo }}</h3>
            <span class="cantidad-equipos">{{ item.value.equipos ? item.value.equipos.length : 0 }} equipos</span>
            <span class="usuario-carnet">{{ item.value.datosgrupo.NombreUsuario }} {{ item.value.datosgrupo.ApellidoPaternoUsuario }} - {{ item.value.datosgrupo.CarnetUsuario }}</span>
          </div>
          <div class="equipo-info">
                    <span class="codigo-imt">Numero de prestamo :  {{ item.key }}</span>
           <span class="codigo-imt">Codigos IMTs : üìã {{ item.value.datosgrupo.CodigoImt || 'N/A' }}</span>
          </div>
        </div>

        <!-- Informaci√≥n de fechas -->
        <div class="fechas-info">
          <div class="fecha-item">
            <span class="fecha-label">üìÖ Solicitud:</span>
            <span class="fecha-valor">{{ item.value.datosgrupo.FechaSolicitud ? (item.value.datosgrupo.FechaSolicitud | date:'dd/MM/yyyy') : 'N/A' }}</span>
          </div>

          <div class="fecha-item">
            <span class="fecha-label">‚úÖ Pr√©stamo:</span>
            <span class="fecha-valor">{{ item.value.datosgrupo.FechaPrestamo ? (item.value.datosgrupo.FechaPrestamo | date:'dd/MM/yyyy') : item.value.datosgrupo.EstadoPrestamo }}</span>
          </div>

          <div class="fecha-item">
            <span class="fecha-label">‚è∞ Devoluci√≥n Esperada:</span>
            <span class="fecha-valor">{{ item.value.datosgrupo.FechaDevolucionEsperada ? (item.value.datosgrupo.FechaDevolucionEsperada | date:'dd/MM/yyyy') : 'N/A' }}</span>
          </div>
        </div>

  <button class="recoger" (click)="$event.stopPropagation(); avisorecogerf(item.value.datosgrupo)"> RECOGIDO</button>
        
  <button class="cancelar" (click)="$event.stopPropagation(); avisocancelarf(item.value.datosgrupo)"> CANCELAR</button>


      </div>
    }

    @if (datos.size === 0) {
      <div class="empty-state">
        <div class="empty-icon">üì•</div>
        <h3>No hay pr√©stamos activos</h3>
        <p>Actualmente no tienes equipos en pr√©stamo</p>
      </div>
    }
  </div>
</div>

@if (avisoaprobar()) {
  <app-aviso
  [mensaje]="'Al recoger el equipo usted afirma que el equipo se encuentra a su disposicion y cualquier problema que tenga con el equipo sera de su responsabilidad.'"
  [cerrar]="avisoaprobar"
  (aceptar)="recoger()"
  >
  </app-aviso>
}

@if (avisocancelar()) {
  <app-aviso
  [mensaje]="'Desea cancelar el pr√©stamo de este equipo? , tenga en cuenta que si lo hace, el equipo no podr√° ser recogido o si ya fue recogido, debe ser devuelto .'"
  [cerrar]="avisocancelar"
  (aceptar)="cancelar()"
  >
  </app-aviso>
}

@if(abrirVistaPrestamos){
  <app-vista-prestamos [prestamos]="prestamosVista" (cerrar)="cerrarVista()"></app-vista-prestamos>
}